---
title: "Designing Modular Software:"
subtitle: "A Case Study in Introductory Statistics"
author: "Eric Hare and **Andee Kaplan**"
institute: "Omni Analytics and Colorado State University"
date: "2019/07/29"
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
class: center, middle

# Background

### Some things to think about when writing software

---

# What is modularity?

### The degree to which a system's components may be separated and recombined.

#### Advantages

- Functionality can be dynamically loaded and unloaded depending on the **particular use case** 


- Open source modularity allows **extensions** contributed by many people


- A **flexible system** that can be tailored to keep software easy to use



---

# What else is important?

### Reproducibility

Encourage **best practices** with regards to disclosure of analysis methods in research

### Extensibility

**Expands** into areas that weren't anticipated early in development

- e.g. packages in `R`, macros in Excel, add-ins in JMP

### Ease of use

Help users **avoid frustration**

- e.g., web technologies eliminate local installation, easy to learn GUI 

---
class: center, middle

# Case study: `intRo`

### Statistical Analysis Software for Teaching

---

# Full disclosure

.pull-left[
![](images/attn.png)
<p style="font-size: 0.9rem;font-style: italic;"><a href="https://svgsilh.com/e91e63/image/98739.html">"warning"</a> is licensed under <a href="https://creativecommons.org/licenses/cc0/1.0/?ref=ccsearch&atype=html" style="margin-right: 5px;">CC0 1.0</a><a href="https://creativecommons.org/licenses/cc0/1.0/?ref=ccsearch&atype=html" target="_blank" rel="noopener noreferrer" style="display: inline-block;white-space: none;opacity: .7;margin-top: 2px;margin-left: 3px;height: 22px !important;"><img style="height: inherit;margin-right: 3px;display: inline-block;" src="https://search.creativecommons.org/static/img/cc_icon.svg" /><img style="height: inherit;margin-right: 3px;display: inline-block;" src="https://search.creativecommons.org/static/img/cc-cc0_icon.svg" /></a></p>
]

.pull-right[
We have an **ulterior motive** to get students excited about programming!

- By navigating about the user interface of `intRo`, students are creating a fully-executable `R` script that they can download and run locally

- Viewing their script change real-time within the application

- This is a sneaky way to **spark curiosity** of students

]

---
class: center, inverse, middle

# Live demo

### http://intro-stats.com

---
background-image: url(images/app_creation_modules.png)
background-position: 50% 100%
background-size: contain

# Modularity

---
# Modularity (Cont'd)
The interface is created with the following statement

```{r, tidy=FALSE, eval=FALSE}
## Source ui
module_info <- read.table("modules/modules.txt", header = TRUE, 
                          sep=",")
sapply(file.path("modules", dir("modules")[dir("modules") 
                      != "modules.txt"], "ui.R"), source)
## Create the UI
shinyUI(navbarPage("intRo", theme = "bootstrap.min.css",
               tabPanel(title="", icon=icon("home"),
                        fluidRow(
                          do.call(navlistPanel, #<<
                              c(list(id = "side-nav", #<<
                              widths = c(2, 10)), mylist)) #<<
                        )
               ), ...
))
```

---
# Modularity (Cont'd)
The server functions are dynamically generated using a similar method

```{r, eval=FALSE, tidy=FALSE}
shinyServer(function(input, output, session) {
  ## Module info
  module_info <- read.table("modules/modules.txt", 
                            header = TRUE, sep=",")
  ## Modules
  types <- c("helper.R", "static.R", "observe.R", 
             "reactive.R", "output.R")
  modules_tosource <- file.path("modules", 
                                apply(expand.grid(
                                module_info$module, types)
                                , 1, paste, collapse = "/"))
  ## Source the modules
  for (mod in modules_tosource) {
    source(mod, local = TRUE) #<<
  }
})
```

---

# Other design decisions

**Reproducibility** and **Ease of Use**

![](images/ui_annotate.png)

---

# But what about Extensibility?

![](https://media.giphy.com/media/3og0INAY5MLmEBubyU/giphy.gif)

Module creation is currently:
 
- Undocumented
- Entirely manual
- Unnecessarily lengthy

---

# Challenges 

### Storing the user's results
 
Users must be able to print results, but only the results they want.
    
### Presenting only relevant options to the user
 
![](images/graphical_table.png)
    
---

# Challenges (with even better solutions)    
    
### Producing clean and executable `R` code 
 
Code generated must be executable on the server, executable on the user's machine, and clean for a human to read. 

```{r, eval=FALSE}
nonparametrictest <- function(intro.data, x, y, conflevel, althyp, hypval) {
  interpolate(~(wilcox.test(x = df$x, y = df$y, #<<
                            conf.level = conf,
                            alternative = althyp,
                            mu = hypval)),
              df = quote(intro.data), x = x, y = y,
              conf = conflevel, althyp = althyp, hypval = hypval,
              mydir = userdir, `_env` = environment(),
              file = "code_nonparametric.R")
}
```


See https://rstudio.github.io/shinymeta for a new (**better**) implementation.

---

# Get started

Access at http://intro-stats.com or **host your own**!

```{r eval=FALSE}
devtools::install_github("gammarama/intRo")
```

- `download_intRo()` - pull the latest version of the application.
- `run_intRo()` - run the application with specified options, like `enabled_modules`.
- `deploy_intRo()`- deploy to ShinyApps.io using your account and options.

```{r eval=FALSE}
download_intRo()
run_intRo(enabled_modules = c("data/transform", "summaries/numerical"),
          theme = "cerulean")
deploy_intRo(enabled_modules = c("data/transform", "summaries/numerical"),
          theme = "cerulean")
```

---

class: center, middle

# Thanks!

http://www.intro-stats.com

.footnote[Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).]


